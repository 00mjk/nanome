bootstrap: docker
from: continuumio/miniconda3

%environment
action="${0##*/}"
if [ "$action" = "shell" ]; then
    if [ "${SINGULARITY_SHELL:-}" = "/bin/bash" ]; then
        set -- --noprofile --init-file /.singularity_bash
    elif test -z "${SINGULARITY_SHELL:-}"; then
        export SINGULARITY_SHELL=/bin/bash
        set -- --noprofile --init-file /.singularity_bash
    fi
fi

%post
cd /opt/
wget https://raw.githubusercontent.com/liuyangzzu/nano-compare/master/environment.yml
chmod 755 environment.yml
/opt/conda/bin/conda env create -f environment.yml
apt-get install -y procps

echo "## Activate nanocompare environment" >> /.singularity_bash
echo "source /opt/conda/etc/profile.d/conda.sh" >> /.singularity_bash
echo "conda activate nanocompare" >> /.singularity_bash

# set to whatever your conda path is, I usually install to /opt
#echo "source /opt/conda/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
#echo "conda activate nanocompare" >> $SINGULARITY_ENVIRONMENT

%runscript
echo "This is nanome enviroment in Singularity!"
exec /bin/bash --noprofile --init-file /.singularity_bash "$@"
#exec /opt/conda/envs/$(head -n 1 /opt/environment.yml | cut -f 2 -d ' ')/bin/"$@"


